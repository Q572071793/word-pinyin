name: ğŸ”§ æŒç»­é›†æˆ

on:
  push:
    branches: [ main, master, develop ]
  pull_request:
    branches: [ main, master, develop ]

jobs:
  lint:
    name: ä»£ç æ£€æŸ¥
    runs-on: ubuntu-latest
    steps:
    - name: ğŸ“¥ æ£€å‡ºä»£ç 
      uses: actions/checkout@v3
    
    - name: ğŸ”§ è®¾ç½®Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        cache: 'npm'
    
    - name: ğŸ“¦ å®‰è£…ä¾èµ–
      run: npm ci
    
    - name: ğŸ” è¿è¡ŒESLint
      run: npm run lint
      continue-on-error: true
    
    - name: ğŸ“Š ä»£ç æ ¼å¼åŒ–æ£€æŸ¥
      run: npm run format:check
      continue-on-error: true

  test:
    name: è¿è¡Œæµ‹è¯•
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest, windows-latest, macos-latest]
        node-version: [14.x, 16.x, 18.x]
    
    steps:
    - name: ğŸ“¥ æ£€å‡ºä»£ç 
      uses: actions/checkout@v3
    
    - name: ğŸ”§ è®¾ç½®Node.js ${{ matrix.node-version }}
      uses: actions/setup-node@v3
      with:
        node-version: ${{ matrix.node-version }}
        cache: 'npm'
    
    - name: ğŸ“¦ å®‰è£…ä¾èµ–
      run: npm ci
    
    - name: ğŸ§ª è¿è¡Œå•å…ƒæµ‹è¯•
      run: npm run test:unit
      continue-on-error: true
    
    - name: ğŸ” è¿è¡Œé›†æˆæµ‹è¯•
      run: npm run test:integration
      continue-on-error: true
    
    - name: ğŸ“Š ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
      run: npm run test:report
      continue-on-error: true
    
    - name: ğŸ“¤ ä¸Šä¼ æµ‹è¯•æŠ¥å‘Š
      if: always()
      uses: actions/upload-artifact@v3
      with:
        name: test-report-${{ matrix.os }}-node${{ matrix.node-version }}
        path: test-report.html
        retention-days: 30

  security:
    name: å®‰å…¨æ‰«æ
    runs-on: ubuntu-latest
    steps:
    - name: ğŸ“¥ æ£€å‡ºä»£ç 
      uses: actions/checkout@v3
    
    - name: ğŸ”§ è®¾ç½®Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        cache: 'npm'
    
    - name: ğŸ“¦ å®‰è£…ä¾èµ–
      run: npm ci
    
    - name: ğŸ” è¿è¡Œå®‰å…¨æ‰«æ
      run: npm audit
      continue-on-error: true
    
    - name: ğŸ›¡ï¸ æ£€æŸ¥ä¾èµ–æ¼æ´
      run: npm audit fix --dry-run
      continue-on-error: true

  build:
    name: æ„å»ºæ£€æŸ¥
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest, windows-latest, macos-latest]
    
    steps:
    - name: ğŸ“¥ æ£€å‡ºä»£ç 
      uses: actions/checkout@v3
    
    - name: ğŸ”§ è®¾ç½®Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        cache: 'npm'
    
    - name: ğŸ“¦ å®‰è£…ä¾èµ–
      run: npm ci
    
    - name: ğŸ—ï¸ æ„å»ºåº”ç”¨
      run: npm run build
    
    - name: ğŸ“Š æ£€æŸ¥æ„å»ºç»“æœ
      run: |
        echo "æ„å»ºå®Œæˆ"
        ls -la build/ || echo "æ„å»ºç›®å½•ä¸å­˜åœ¨"
      shell: bash
    
    - name: ğŸ“¤ ä¸Šä¼ æ„å»ºäº§ç‰©
      uses: actions/upload-artifact@v3
      with:
        name: build-${{ matrix.os }}
        path: build/
        retention-days: 7